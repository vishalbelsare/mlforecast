<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Full pipeline encapsulation">

<title>mlforecast - MLForecast</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NXJNCVR18L"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NXJNCVR18L', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="mlforecast - MLForecast">
<meta property="og:description" content="Full pipeline encapsulation">
<meta property="og:image" content="https://github.com/Nixtla/styles/blob/2abf51612584169874c90cd7c4d347e3917eaf73/images/Banner%20Github.png">
<meta property="og:site-name" content="mlforecast">
<meta name="twitter:title" content="mlforecast - MLForecast">
<meta name="twitter:description" content="Full pipeline encapsulation">
<meta name="twitter:image" content="https://farm6.staticflickr.com/5510/14338202952_93595258ff_z.jpg">
<meta name="twitter:site" content="@Nixtlainc">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">mlforecast</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./docs/quick_start_local.html" rel="" target="" aria-current="page">
 <span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-nixtlaverse" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">NixtlaVerse</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-nixtlaverse">    
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/statsforecast" rel="" target="">
 <span class="dropdown-text">StatsForecast ‚ö°Ô∏è</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/neuralforecast" rel="" target="">
 <span class="dropdown-text">NeuralForecast üß†</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/hierarchicalforecast" rel="" target="">
 <span class="dropdown-text">HierarchicalForecast üëë</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-help" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Help</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-help">    
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/mlforecast/issues/new/choose" rel="" target=""><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Report an Issue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://join.slack.com/t/nixtlaworkspace/shared_invite/zt-135dssye9-fWTzMpv2WBthq8NK0Yvu6A" rel="" target=""><i class="bi bi-chat-right-text" role="img">
</i> 
 <span class="dropdown-text">Join our Slack</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/nixtla/mlforecast" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/nixtlainc" rel="" target=""><i class="bi bi-twitter" role="img" aria-label="Nixtla Twitter">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">API reference</li><li class="breadcrumb-item"><a href="./forecast.html">Local</a></li><li class="breadcrumb-item"><a href="./forecast.html">MLForecast</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nixtla &nbsp; <a href="https://twitter.com/intent/tweet?text=Statistical%20Forecasting%20Algorithms%20by%20Nixtla%20&amp;url=https://github.com/Nixtla/statsforecast&amp;via=nixtlainc&amp;hashtags=StatisticalModels,TimeSeries,Forecasting"><img src="https://img.shields.io/twitter/url/http/shields.io.svg?style=social" class="img-fluid" alt="Tweet"></a> &nbsp;<a href="https://join.slack.com/t/nixtlacommunity/shared_invite/zt-1pmhan9j5-F54XR20edHk0UtYAPcW4KQ"><img src="https://img.shields.io/badge/Slack-4A154B?&amp;logo=slack&amp;logoColor=white.png" class="img-fluid" alt="Slack"></a></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./docs/install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./docs/quick_start_local.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick start (local)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./docs/quick_start_distributed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick start (distributed)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./docs/end_to_end_walkthrough.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">End to end walkthrough</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./docs/cross_validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cross validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./docs/electricity_peak_forecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Detect Demand Peaks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./docs/prediction_intervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic forecasting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./docs/transfer_learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Transfer Learning</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">API reference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Local</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./forecast.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">MLForecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lgb_cv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LightGBMCV</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Utils</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Distributed</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distributed.forecast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DistributedMLForecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distributed.models.dask.lgb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DaskLGBMForecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distributed.models.dask.xgb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DaskXGBForecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distributed.models.spark.lgb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SparkLGBMForecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./distributed.models.spark.xgb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SparkXGBForecast</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#mlforecast" id="toc-mlforecast" class="nav-link active" data-scroll-target="#mlforecast">MLForecast</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a>
  <ul class="collapse">
  <li><a href="#creating-the-forecast-object" id="toc-creating-the-forecast-object" class="nav-link" data-scroll-target="#creating-the-forecast-object">Creating the Forecast object</a></li>
  <li><a href="#mlforecast.fit" id="toc-mlforecast.fit" class="nav-link" data-scroll-target="#mlforecast.fit">MLForecast.fit</a></li>
  <li><a href="#mlforecast.predict" id="toc-mlforecast.predict" class="nav-link" data-scroll-target="#mlforecast.predict">MLForecast.predict</a></li>
  <li><a href="#mlforecast.preprocess" id="toc-mlforecast.preprocess" class="nav-link" data-scroll-target="#mlforecast.preprocess">MLForecast.preprocess</a></li>
  <li><a href="#mlforecast.fit_models" id="toc-mlforecast.fit_models" class="nav-link" data-scroll-target="#mlforecast.fit_models">MLForecast.fit_models</a></li>
  <li><a href="#multi-output-model" id="toc-multi-output-model" class="nav-link" data-scroll-target="#multi-output-model">Multi-output model</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">Cross validation</a></li>
  <li><a href="#mlforecast.cross_validation" id="toc-mlforecast.cross_validation" class="nav-link" data-scroll-target="#mlforecast.cross_validation">MLForecast.cross_validation</a></li>
  <li><a href="#create-mlforecast-from-lightgbmcv" id="toc-create-mlforecast-from-lightgbmcv" class="nav-link" data-scroll-target="#create-mlforecast-from-lightgbmcv">Create MLForecast from LightGBMCV</a></li>
  <li><a href="#dynamic-features" id="toc-dynamic-features" class="nav-link" data-scroll-target="#dynamic-features">Dynamic features</a></li>
  <li><a href="#custom-predictions" id="toc-custom-predictions" class="nav-link" data-scroll-target="#custom-predictions">Custom predictions</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Nixtla/mlforecast/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MLForecast</h1>
</div>

<div>
  <div class="description">
    Full pipeline encapsulation
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<hr>
<section id="mlforecast" class="level3">
<h3 class="anchored" data-anchor-id="mlforecast">MLForecast</h3>
<blockquote class="blockquote">
<pre><code> MLForecast (models:Union[sklearn.base.BaseEstimator,List[sklearn.base.Bas
             eEstimator],Dict[str,sklearn.base.BaseEstimator]], freq:Union
             [int,str,pandas._libs.tslibs.offsets.BaseOffset,NoneType]=Non
             e, lags:Optional[Iterable[int]]=None, lag_transforms:Optional
             [Dict[int,List[Union[Callable,Tuple[Callable,Any]]]]]=None,
             date_features:Optional[Iterable[Union[str,Callable]]]=None,
             differences:Optional[Iterable[int]]=None, num_threads:int=1, 
             target_transforms:Optional[List[mlforecast.target_transforms.
             BaseTargetTransform]]=None)</code></pre>
</blockquote>
<p>Create forecast object</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>models</td>
<td>typing.Union[sklearn.base.BaseEstimator, typing.List[sklearn.base.BaseEstimator], typing.Dict[str, sklearn.base.BaseEstimator]]</td>
<td></td>
<td>Models that will be trained and used to compute the forecasts.</td>
</tr>
<tr class="even">
<td>freq</td>
<td>typing.Union[int, str, pandas._libs.tslibs.offsets.BaseOffset, NoneType]</td>
<td>None</td>
<td>Pandas offset, pandas offset alias, e.g.&nbsp;‚ÄòD‚Äô, ‚ÄòW-THU‚Äô or integer denoting the frequency of the series.</td>
</tr>
<tr class="odd">
<td>lags</td>
<td>typing.Optional[typing.Iterable[int]]</td>
<td>None</td>
<td>Lags of the target to use as features.</td>
</tr>
<tr class="even">
<td>lag_transforms</td>
<td>typing.Optional[typing.Dict[int, typing.List[typing.Union[typing.Callable, typing.Tuple[typing.Callable, typing.Any]]]]]</td>
<td>None</td>
<td>Mapping of target lags to their transformations.</td>
</tr>
<tr class="odd">
<td>date_features</td>
<td>typing.Optional[typing.Iterable[typing.Union[str, typing.Callable]]]</td>
<td>None</td>
<td>Features computed from the dates. Can be pandas date attributes or functions that will take the dates as input.</td>
</tr>
<tr class="even">
<td>differences</td>
<td>typing.Optional[typing.Iterable[int]]</td>
<td>None</td>
<td>Differences to take of the target before computing the features. These are restored at the forecasting step.</td>
</tr>
<tr class="odd">
<td>num_threads</td>
<td>int</td>
<td>1</td>
<td>Number of threads to use when computing the features.</td>
</tr>
<tr class="even">
<td>target_transforms</td>
<td>typing.Optional[typing.List[mlforecast.target_transforms.BaseTargetTransform]]</td>
<td>None</td>
<td>Transformations that will be applied to the target before computing the features and restored after the forecasting step.</td>
</tr>
</tbody>
</table>
<p>The <code>MLForecast</code> class is a high level abstraction that encapsulates all the steps in the pipeline (preprocessing, fitting the model and computing the predictions). It tries to mimic the scikit-learn API.</p>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example</h2>
<p>This shows an example with just 4 series of the M4 dataset. If you want to run it yourself on all of them, you can refer to <a href="https://www.kaggle.com/code/lemuz90/m4-competition">this notebook</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> lightgbm <span class="im">as</span> lgb</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasetsforecast.m4 <span class="im">import</span> M4, M4Info</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> window_ops.ewm <span class="im">import</span> ewm_mean</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> window_ops.expanding <span class="im">import</span> expanding_mean</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> window_ops.rolling <span class="im">import</span> rolling_mean</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mlforecast.lgb_cv <span class="im">import</span> LightGBMCV</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mlforecast.target_transforms <span class="im">import</span> Differences</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mlforecast.utils <span class="im">import</span> generate_daily_series, generate_prices_for_series</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>group <span class="op">=</span> <span class="st">'Hourly'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> M4.async_download(<span class="st">'data'</span>, group<span class="op">=</span>group)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df, <span class="op">*</span>_ <span class="op">=</span> M4.load(directory<span class="op">=</span><span class="st">'data'</span>, group<span class="op">=</span>group)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'ds'</span>] <span class="op">=</span> df[<span class="st">'ds'</span>].astype(<span class="st">'int'</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>ids <span class="op">=</span> df[<span class="st">'unique_id'</span>].unique()</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">0</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>sample_ids <span class="op">=</span> random.choices(ids, k<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>sample_df <span class="op">=</span> df[df[<span class="st">'unique_id'</span>].isin(sample_ids)]</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>sample_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">86796</td>
<td>H196</td>
<td>1</td>
<td>11.8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86797</td>
<td>H196</td>
<td>2</td>
<td>11.4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86798</td>
<td>H196</td>
<td>3</td>
<td>11.1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86799</td>
<td>H196</td>
<td>4</td>
<td>10.8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86800</td>
<td>H196</td>
<td>5</td>
<td>10.6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">325235</td>
<td>H413</td>
<td>1004</td>
<td>99.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">325236</td>
<td>H413</td>
<td>1005</td>
<td>88.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">325237</td>
<td>H413</td>
<td>1006</td>
<td>47.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">325238</td>
<td>H413</td>
<td>1007</td>
<td>41.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">325239</td>
<td>H413</td>
<td>1008</td>
<td>34.0</td>
</tr>
</tbody>
</table>

<p>4032 rows √ó 3 columns</p>
</div>
</div>
</div>
<p>We now split this data into train and validation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>info <span class="op">=</span> M4Info[group]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>horizon <span class="op">=</span> info.horizon</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>valid <span class="op">=</span> sample_df.groupby(<span class="st">'unique_id'</span>).tail(horizon)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> sample_df.drop(valid.index)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>train.shape, valid.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>((3840, 3), (192, 3))</code></pre>
</div>
</div>
<section id="creating-the-forecast-object" class="level3">
<h3 class="anchored" data-anchor-id="creating-the-forecast-object">Creating the Forecast object</h3>
<p>The forecast object encapsulates the feature engineering + training the models + forecasting. When we initialize it we define:</p>
<ul>
<li>The models we want to train</li>
<li>The series frequency. This is added to the last dates seen in train for the forecast step, if the time column contains integer values we can leave it empty or set it to 1.</li>
<li>The feature engineering:
<ul>
<li>Lags to use as features</li>
<li>Transformations on the lags</li>
<li>Date features</li>
<li>Differences to apply to the target before computing the features, which are then restored when forecasting.</li>
</ul></li>
<li>Number of threads to use when computing the features.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fcst <span class="op">=</span> MLForecast(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    models<span class="op">=</span>lgb.LGBMRegressor(random_state<span class="op">=</span><span class="dv">0</span>),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    lags<span class="op">=</span>[<span class="dv">24</span> <span class="op">*</span> (i<span class="op">+</span><span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)],</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    lag_transforms<span class="op">=</span>{</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">48</span>: [(ewm_mean, <span class="fl">0.3</span>)],</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    num_threads<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    target_transforms<span class="op">=</span>[Differences([<span class="dv">24</span>])],</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>fcst</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>MLForecast(models=[LGBMRegressor], freq=1, lag_features=['lag24', 'lag48', 'lag72', 'lag96', 'lag120', 'lag144', 'lag168', 'ewm_mean_lag48_alpha0.3'], date_features=[], num_threads=1)</code></pre>
</div>
</div>
<p>Once we have this setup we can compute the features and fit the model.</p>
<hr>
</section>
<section id="mlforecast.fit" class="level3">
<h3 class="anchored" data-anchor-id="mlforecast.fit">MLForecast.fit</h3>
<blockquote class="blockquote">
<pre><code> MLForecast.fit (df:pandas.core.frame.DataFrame, id_col:str='unique_id',
                 time_col:str='ds', target_col:str='y',
                 static_features:Optional[List[str]]=None,
                 dropna:bool=True, keep_last_n:Optional[int]=None,
                 max_horizon:Optional[int]=None, prediction_intervals:Opti
                 onal[mlforecast.utils.PredictionIntervals]=None,
                 data:Optional[pandas.core.frame.DataFrame]=None)</code></pre>
</blockquote>
<p>Apply the feature engineering and train the models.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>df</td>
<td>DataFrame</td>
<td></td>
<td>Series data in long format.</td>
</tr>
<tr class="even">
<td>id_col</td>
<td>str</td>
<td>unique_id</td>
<td>Column that identifies each serie.</td>
</tr>
<tr class="odd">
<td>time_col</td>
<td>str</td>
<td>ds</td>
<td>Column that identifies each timestep, its values can be timestamps or integers.</td>
</tr>
<tr class="even">
<td>target_col</td>
<td>str</td>
<td>y</td>
<td>Column that contains the target.</td>
</tr>
<tr class="odd">
<td>static_features</td>
<td>typing.Optional[typing.List[str]]</td>
<td>None</td>
<td>Names of the features that are static and will be repeated when forecasting.</td>
</tr>
<tr class="even">
<td>dropna</td>
<td>bool</td>
<td>True</td>
<td>Drop rows with missing values produced by the transformations.</td>
</tr>
<tr class="odd">
<td>keep_last_n</td>
<td>typing.Optional[int]</td>
<td>None</td>
<td>Keep only these many records from each serie for the forecasting step. Can save time and memory if your features allow it.</td>
</tr>
<tr class="even">
<td>max_horizon</td>
<td>typing.Optional[int]</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>prediction_intervals</td>
<td>typing.Optional[mlforecast.utils.PredictionIntervals]</td>
<td>None</td>
<td>Configuration to calibrate prediction intervals (Conformal Prediction).</td>
</tr>
<tr class="even">
<td>data</td>
<td>typing.Optional[pandas.core.frame.DataFrame]</td>
<td>None</td>
<td>Series data in long format. This argument has been replaced by df and will be removed in a later release.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>MLForecast</strong></td>
<td></td>
<td><strong>noqa: ARG002</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fcst.fit(train)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we‚Äôve run this we‚Äôre ready to compute our predictions.</p>
<hr>
</section>
<section id="mlforecast.predict" class="level3">
<h3 class="anchored" data-anchor-id="mlforecast.predict">MLForecast.predict</h3>
<blockquote class="blockquote">
<pre><code> MLForecast.predict (h:int,
                     dynamic_dfs:Optional[List[pandas.core.frame.DataFrame
                     ]]=None,
                     before_predict_callback:Optional[Callable]=None,
                     after_predict_callback:Optional[Callable]=None,
                     new_df:Optional[pandas.core.frame.DataFrame]=None,
                     level:Optional[List[Union[int,float]]]=None,
                     horizon:Optional[int]=None,
                     new_data:Optional[pandas.core.frame.DataFrame]=None)</code></pre>
</blockquote>
<p>Compute the predictions for the next <code>horizon</code> steps.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>h</td>
<td>int</td>
<td></td>
<td>Number of periods to predict.</td>
</tr>
<tr class="even">
<td>dynamic_dfs</td>
<td>typing.Optional[typing.List[pandas.core.frame.DataFrame]]</td>
<td>None</td>
<td>Future values of the dynamic features, e.g.&nbsp;prices.</td>
</tr>
<tr class="odd">
<td>before_predict_callback</td>
<td>typing.Optional[typing.Callable]</td>
<td>None</td>
<td>Function to call on the features before computing the predictions.<br> This function will take the input dataframe that will be passed to the model for predicting and should return a dataframe with the same structure.<br> The series identifier is on the index.</td>
</tr>
<tr class="even">
<td>after_predict_callback</td>
<td>typing.Optional[typing.Callable]</td>
<td>None</td>
<td>Function to call on the predictions before updating the targets.<br> This function will take a pandas Series with the predictions and should return another one with the same structure.<br> The series identifier is on the index.</td>
</tr>
<tr class="odd">
<td>new_df</td>
<td>typing.Optional[pandas.core.frame.DataFrame]</td>
<td>None</td>
<td>Series data of new observations for which forecasts are to be generated. <br> This dataframe should have the same structure as the one used to fit the model, including any features and time series data. <br> If <code>new_df</code> is not None, the method will generate forecasts for the new observations.</td>
</tr>
<tr class="even">
<td>level</td>
<td>typing.Optional[typing.List[typing.Union[int, float]]]</td>
<td>None</td>
<td>Confidence levels between 0 and 100 for prediction intervals.</td>
</tr>
<tr class="odd">
<td>horizon</td>
<td>typing.Optional[int]</td>
<td>None</td>
<td>Number of periods to predict. This argument has been replaced by h and will be removed in a later release.</td>
</tr>
<tr class="even">
<td>new_data</td>
<td>typing.Optional[pandas.core.frame.DataFrame]</td>
<td>None</td>
<td>Series data of new observations for which forecasts are to be generated. <br> This dataframe should have the same structure as the one used to fit the model, including any features and time series data. <br> If <code>new_data</code> is not None, the method will generate forecasts for the new observations.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>DataFrame</strong></td>
<td></td>
<td><strong>noqa: ARG002<br>noqa: ARG002 </strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> fcst.predict(horizon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see at a couple of results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> valid.merge(predictions, on<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>]).set_index(<span class="st">'unique_id'</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">10</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> uid, axi <span class="kw">in</span> <span class="bu">zip</span>(sample_ids, ax.flat):</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    results.loc[uid].set_index(<span class="st">'ds'</span>).plot(ax<span class="op">=</span>axi, title<span class="op">=</span>uid)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">'figs/forecast__predict.png'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="figs/forecast__predict.png" class="img-fluid"></p>
<section id="prediction-intervals" class="level4">
<h4 class="anchored" data-anchor-id="prediction-intervals">Prediction intervals</h4>
<p>With <code>MLForecast</code>, you can generate prediction intervals using Conformal Prediction. To configure Conformal Prediction, you need to pass an instance of the <code>PredictionIntervals</code> class to the <code>prediction_intervals</code> argument of the <code>fit</code> method. The class takes three parameters: <code>n_windows</code>, <code>h</code> and <code>method</code>.</p>
<ul>
<li><code>n_windows</code> represents the number of cross-validation windows used to calibrate the intervals</li>
<li><code>h</code> is the forecast horizon</li>
<li><code>method</code> can be <code>conformal_distribution</code> or <code>conformal_error</code>; <code>conformal_distribution</code> (default) creates forecasts paths based on the cross-validation errors and calculate quantiles using those paths, on the other hand <code>conformal_error</code> calculates the error quantiles to produce prediction intervals. The strategy will adjust the intervals for each horizon step, resulting in different widths for each step. Please note that a minimum of 2 cross-validation windows must be used.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fcst.fit(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    train, </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    prediction_intervals<span class="op">=</span>PredictionIntervals(n_windows<span class="op">=</span><span class="dv">3</span>, h<span class="op">=</span><span class="dv">48</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After that, you just have to include your desired confidence levels to the <code>predict</code> method using the <code>level</code> argument. Levels must lie between 0 and 100.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>predictions_w_intervals <span class="op">=</span> fcst.predict(<span class="dv">48</span>, level<span class="op">=</span>[<span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">95</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>predictions_w_intervals.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">LGBMRegressor</th>
<th data-quarto-table-cell-role="th">LGBMRegressor-lo-95</th>
<th data-quarto-table-cell-role="th">LGBMRegressor-lo-80</th>
<th data-quarto-table-cell-role="th">LGBMRegressor-lo-50</th>
<th data-quarto-table-cell-role="th">LGBMRegressor-hi-50</th>
<th data-quarto-table-cell-role="th">LGBMRegressor-hi-80</th>
<th data-quarto-table-cell-role="th">LGBMRegressor-hi-95</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>H196</td>
<td>961</td>
<td>16.071271</td>
<td>15.958042</td>
<td>15.971271</td>
<td>16.005091</td>
<td>16.137452</td>
<td>16.171271</td>
<td>16.184501</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>H196</td>
<td>962</td>
<td>15.671271</td>
<td>15.553632</td>
<td>15.553632</td>
<td>15.578632</td>
<td>15.763911</td>
<td>15.788911</td>
<td>15.788911</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>H196</td>
<td>963</td>
<td>15.271271</td>
<td>15.153632</td>
<td>15.153632</td>
<td>15.162452</td>
<td>15.380091</td>
<td>15.388911</td>
<td>15.388911</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>H196</td>
<td>964</td>
<td>14.971271</td>
<td>14.858042</td>
<td>14.871271</td>
<td>14.905091</td>
<td>15.037452</td>
<td>15.071271</td>
<td>15.084501</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>H196</td>
<td>965</td>
<td>14.671271</td>
<td>14.553632</td>
<td>14.553632</td>
<td>14.562452</td>
<td>14.780091</td>
<td>14.788911</td>
<td>14.788911</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test we can forecast horizon lower than h </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with prediction intervals</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> method <span class="kw">in</span> [<span class="st">'conformal_distribution'</span>, <span class="st">'conformal_errors'</span>]:</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    fcst.fit(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        train, </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        prediction_intervals<span class="op">=</span>PredictionIntervals(n_windows<span class="op">=</span><span class="dv">3</span>, h<span class="op">=</span><span class="dv">48</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    preds_h_lower_h <span class="op">=</span> fcst.predict(<span class="dv">1</span>, level<span class="op">=</span>[<span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">95</span>])</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    preds_h_lower_h <span class="op">=</span> fcst.predict(<span class="dv">30</span>, level<span class="op">=</span>[<span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">95</span>])</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># test monotonicity of intervals</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    test_eq(</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        preds_h_lower_h.<span class="bu">filter</span>(regex<span class="op">=</span><span class="st">'lo|hi'</span>).<span class="bu">apply</span>(</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">lambda</span> x: x.is_monotonic_increasing,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            axis<span class="op">=</span><span class="dv">1</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>        ).<span class="bu">sum</span>(),</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">len</span>(preds_h_lower_h)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let‚Äôs explore the generated intervals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> valid.merge(predictions_w_intervals, on<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>]).set_index(<span class="st">'unique_id'</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">10</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> uid, axi <span class="kw">in</span> <span class="bu">zip</span>(sample_ids, ax.flat):</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    uid_results <span class="op">=</span> results.loc[uid].set_index(<span class="st">'ds'</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    uid_results[[<span class="st">'y'</span>, <span class="st">'LGBMRegressor'</span>]].plot(ax<span class="op">=</span>axi, title<span class="op">=</span>uid)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> lv <span class="kw">in</span> [<span class="dv">50</span>, <span class="dv">80</span>, <span class="dv">95</span>]:</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        axi.fill_between(</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>            uid_results.index, </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>            uid_results[<span class="ss">f'LGBMRegressor-lo-</span><span class="sc">{</span>lv<span class="sc">}</span><span class="ss">'</span>].values, </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            uid_results[<span class="ss">f'LGBMRegressor-hi-</span><span class="sc">{</span>lv<span class="sc">}</span><span class="ss">'</span>].values,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="ss">f'LGBMRegressor-level-</span><span class="sc">{</span>lv<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            color<span class="op">=</span><span class="st">'orange'</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>            alpha<span class="op">=</span><span class="dv">1</span> <span class="op">-</span> lv <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    axi.legend()</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">'figs/forecast__predict_intervals.png'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="figs/forecast__predict_intervals.png" class="img-fluid"></p>
<p>If you want to reduce the computational time and produce intervals with the same width for the whole forecast horizon, simple pass <code>h=1</code> to the <code>PredictionIntervals</code> class. The caveat of this strategy is that in some cases, variance of the absolute residuals maybe be small (even zero), so the intervals may be too narrow.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fcst.fit(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    train,  </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    prediction_intervals<span class="op">=</span>PredictionIntervals(n_windows<span class="op">=</span><span class="dv">3</span>, h<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>predictions_w_intervals_ws_1 <span class="op">=</span> fcst.predict(<span class="dv">48</span>, level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">95</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let‚Äôs explore the generated intervals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> valid.merge(predictions_w_intervals_ws_1, on<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>]).set_index(<span class="st">'unique_id'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">10</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> uid, axi <span class="kw">in</span> <span class="bu">zip</span>(sample_ids, ax.flat):</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    uid_results <span class="op">=</span> results.loc[uid].set_index(<span class="st">'ds'</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    uid_results[[<span class="st">'y'</span>, <span class="st">'LGBMRegressor'</span>]].plot(ax<span class="op">=</span>axi, title<span class="op">=</span>uid)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    axi.fill_between(</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        uid_results.index, </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>        uid_results[<span class="st">'LGBMRegressor-lo-90'</span>].values, </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        uid_results[<span class="st">'LGBMRegressor-hi-90'</span>].values,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">'LGBMRegressor-level-90'</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'orange'</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.2</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    axi.legend()</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">'figs/forecast__predict_intervals_window_size_1.png'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="figs/forecast__predict_intervals_window_size_1.png" class="img-fluid"></p>
</section>
<section id="forecast-using-a-pretrained-model" class="level4">
<h4 class="anchored" data-anchor-id="forecast-using-a-pretrained-model">Forecast using a pretrained model</h4>
<p>MLForecast allows you to use a pretrained model to generate forecasts for a new dataset. Simply provide a pandas dataframe containing the new observations as the value for the <code>new_data</code> argument when calling the <code>predict</code> method. The dataframe should have the same structure as the one used to fit the model, including any features and time series data. The function will then use the pretrained model to generate forecasts for the new observations. This allows you to easily apply a pretrained model to a new dataset and generate forecasts without the need to retrain the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ercot_df <span class="op">=</span> pd.read_csv(<span class="st">'https://datasets-nixtla.s3.amazonaws.com/ERCOT-clean.csv'</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we have to convert the ds column to integers</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># since MLForecast was trained with that structure</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>ercot_df[<span class="st">'ds'</span>] <span class="op">=</span> np.arange(<span class="dv">1</span>, <span class="bu">len</span>(ercot_df) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># use the `new_data` argument to pass the ercot dataset </span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>ercot_fcsts <span class="op">=</span> fcst.predict(horizon, new_df<span class="op">=</span>ercot_df)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>ercot_df.tail(<span class="dv">48</span> <span class="op">*</span> <span class="dv">2</span>).plot(x<span class="op">=</span><span class="st">'ds'</span>, y<span class="op">=</span><span class="st">'y'</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">7</span>), ax<span class="op">=</span>ax)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>ercot_fcsts.plot(x<span class="op">=</span><span class="st">'ds'</span>, y<span class="op">=</span><span class="st">'LGBMRegressor'</span>, ax<span class="op">=</span>ax, title<span class="op">=</span><span class="st">'ERCOT forecasts trained on M4-Hourly dataset'</span>)<span class="op">;</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>plt.gcf().savefig(<span class="st">'figs/forecast__ercot.png'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="figs/forecast__ercot.png" class="img-fluid"></p>
<p>If you want to take a look at the data that will be used to train the models you can call <code>Forecast.preprocess</code>.</p>
<hr>
</section>
</section>
<section id="mlforecast.preprocess" class="level3">
<h3 class="anchored" data-anchor-id="mlforecast.preprocess">MLForecast.preprocess</h3>
<blockquote class="blockquote">
<pre><code> MLForecast.preprocess (df:pandas.core.frame.DataFrame,
                        id_col:str='unique_id', time_col:str='ds',
                        target_col:str='y',
                        static_features:Optional[List[str]]=None,
                        dropna:bool=True, keep_last_n:Optional[int]=None,
                        max_horizon:Optional[int]=None,
                        return_X_y:bool=False,
                        data:Optional[pandas.core.frame.DataFrame]=None)</code></pre>
</blockquote>
<p>Add the features to <code>data</code>.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>df</td>
<td>DataFrame</td>
<td></td>
<td>Series data in long format.</td>
</tr>
<tr class="even">
<td>id_col</td>
<td>str</td>
<td>unique_id</td>
<td>Column that identifies each serie.</td>
</tr>
<tr class="odd">
<td>time_col</td>
<td>str</td>
<td>ds</td>
<td>Column that identifies each timestep, its values can be timestamps or integers.</td>
</tr>
<tr class="even">
<td>target_col</td>
<td>str</td>
<td>y</td>
<td>Column that contains the target.</td>
</tr>
<tr class="odd">
<td>static_features</td>
<td>typing.Optional[typing.List[str]]</td>
<td>None</td>
<td>Names of the features that are static and will be repeated when forecasting.</td>
</tr>
<tr class="even">
<td>dropna</td>
<td>bool</td>
<td>True</td>
<td>Drop rows with missing values produced by the transformations.</td>
</tr>
<tr class="odd">
<td>keep_last_n</td>
<td>typing.Optional[int]</td>
<td>None</td>
<td>Keep only these many records from each serie for the forecasting step. Can save time and memory if your features allow it.</td>
</tr>
<tr class="even">
<td>max_horizon</td>
<td>typing.Optional[int]</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>return_X_y</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
<tr class="even">
<td>data</td>
<td>typing.Optional[pandas.core.frame.DataFrame]</td>
<td>None</td>
<td>Series data in long format. This argument has been replaced by df and will be removed in a later release.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>typing.Union[pandas.core.frame.DataFrame, typing.Tuple[pandas.core.frame.DataFrame, typing.Union[pandas.core.series.Series, pandas.core.frame.DataFrame]]]</strong></td>
<td></td>
<td><strong>noqa: ARG002</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>prep_df <span class="op">=</span> fcst.preprocess(train)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>prep_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">lag24</th>
<th data-quarto-table-cell-role="th">lag48</th>
<th data-quarto-table-cell-role="th">lag72</th>
<th data-quarto-table-cell-role="th">lag96</th>
<th data-quarto-table-cell-role="th">lag120</th>
<th data-quarto-table-cell-role="th">lag144</th>
<th data-quarto-table-cell-role="th">lag168</th>
<th data-quarto-table-cell-role="th">ewm_mean_lag48_alpha0.3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">86988</td>
<td>H196</td>
<td>193</td>
<td>0.1</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.3</td>
<td>0.1</td>
<td>0.1</td>
<td>0.3</td>
<td>0.002810</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86989</td>
<td>H196</td>
<td>194</td>
<td>0.1</td>
<td>-0.1</td>
<td>0.1</td>
<td>0.0</td>
<td>0.3</td>
<td>0.1</td>
<td>0.1</td>
<td>0.3</td>
<td>0.031967</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86990</td>
<td>H196</td>
<td>195</td>
<td>0.1</td>
<td>-0.1</td>
<td>0.1</td>
<td>0.0</td>
<td>0.3</td>
<td>0.1</td>
<td>0.2</td>
<td>0.1</td>
<td>0.052377</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">86991</td>
<td>H196</td>
<td>196</td>
<td>0.1</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.3</td>
<td>0.2</td>
<td>0.1</td>
<td>0.2</td>
<td>0.036664</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86992</td>
<td>H196</td>
<td>197</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.1</td>
<td>0.2</td>
<td>0.2</td>
<td>0.1</td>
<td>0.2</td>
<td>0.025665</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">325187</td>
<td>H413</td>
<td>956</td>
<td>0.0</td>
<td>10.0</td>
<td>1.0</td>
<td>6.0</td>
<td>-53.0</td>
<td>44.0</td>
<td>-21.0</td>
<td>21.0</td>
<td>7.963225</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">325188</td>
<td>H413</td>
<td>957</td>
<td>9.0</td>
<td>10.0</td>
<td>10.0</td>
<td>-7.0</td>
<td>-46.0</td>
<td>27.0</td>
<td>-19.0</td>
<td>24.0</td>
<td>8.574257</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">325189</td>
<td>H413</td>
<td>958</td>
<td>16.0</td>
<td>8.0</td>
<td>5.0</td>
<td>-9.0</td>
<td>-36.0</td>
<td>32.0</td>
<td>-13.0</td>
<td>8.0</td>
<td>7.501980</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">325190</td>
<td>H413</td>
<td>959</td>
<td>-3.0</td>
<td>17.0</td>
<td>-7.0</td>
<td>2.0</td>
<td>-31.0</td>
<td>22.0</td>
<td>5.0</td>
<td>-2.0</td>
<td>3.151386</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">325191</td>
<td>H413</td>
<td>960</td>
<td>15.0</td>
<td>11.0</td>
<td>-6.0</td>
<td>-5.0</td>
<td>-17.0</td>
<td>22.0</td>
<td>-18.0</td>
<td>10.0</td>
<td>0.405970</td>
</tr>
</tbody>
</table>

<p>3072 rows √ó 11 columns</p>
</div>
</div>
</div>
<p>If we do this we then have to call <code>Forecast.fit_models</code>, since this only stores the series information.</p>
<hr>
</section>
<section id="mlforecast.fit_models" class="level3">
<h3 class="anchored" data-anchor-id="mlforecast.fit_models">MLForecast.fit_models</h3>
<blockquote class="blockquote">
<pre><code> MLForecast.fit_models (X:pandas.core.frame.DataFrame,
                        y:Union[pandas.core.series.Series,pandas.core.fram
                        e.DataFrame])</code></pre>
</blockquote>
<p>Manually train models. Use this if you called <code>Forecast.preprocess</code> beforehand.</p>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 38%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>X</td>
<td>DataFrame</td>
<td>Features.</td>
</tr>
<tr class="even">
<td>y</td>
<td>typing.Union[pandas.core.series.Series, pandas.core.frame.DataFrame]</td>
<td>Target.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>MLForecast</strong></td>
<td><strong>Forecast object with trained models.</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>X, y <span class="op">=</span> prep_df.drop(columns<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>, <span class="st">'y'</span>]), prep_df[<span class="st">'y'</span>]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>fcst.fit_models(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>MLForecast(models=[LGBMRegressor], freq=1, lag_features=['lag24', 'lag48', 'lag72', 'lag96', 'lag120', 'lag144', 'lag168', 'ewm_mean_lag48_alpha0.3'], date_features=[], num_threads=1)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>predictions2 <span class="op">=</span> fcst.predict(horizon)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>pd.testing.assert_frame_equal(predictions, predictions2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="multi-output-model" class="level3">
<h3 class="anchored" data-anchor-id="multi-output-model">Multi-output model</h3>
<p>By default mlforecast uses the recursive strategy, i.e.&nbsp;a model is trained to predict the next value and if we‚Äôre predicting several values we do it one at a time and then use the model‚Äôs predictions as the new target, recompute the features and predict the next step.</p>
<p>There‚Äôs another approach where if we want to predict 10 steps ahead we train 10 different models, where each model is trained to predict the value at each specific step, i.e.&nbsp;one model predicts the next value, another one predicts the value two steps ahead and so on. This can be very time consuming but can also provide better results. If you want to use this approach you can specify <code>max_horizon</code> in <code>MLForecast.fit</code>, which will train that many models and each model will predict its corresponding horizon when you call <code>MLForecast.predict</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> avg_mape(df):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    full <span class="op">=</span> df.merge(valid)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(full[<span class="st">'LGBMRegressor'</span>] <span class="op">-</span> full[<span class="st">'y'</span>]).div(full[<span class="st">'y'</span>]).groupby(full[<span class="st">'unique_id'</span>]).mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fcst <span class="op">=</span> MLForecast(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    models<span class="op">=</span>lgb.LGBMRegressor(random_state<span class="op">=</span><span class="dv">0</span>),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    lags<span class="op">=</span>[<span class="dv">24</span> <span class="op">*</span> (i<span class="op">+</span><span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)],</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    lag_transforms<span class="op">=</span>{</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>: [(rolling_mean, <span class="dv">24</span>)],</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">24</span>: [(rolling_mean, <span class="dv">24</span>)],</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        <span class="dv">48</span>: [(ewm_mean, <span class="fl">0.3</span>)],</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    num_threads<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    target_transforms<span class="op">=</span>[Differences([<span class="dv">24</span>])],</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>max_horizon <span class="op">=</span> <span class="dv">24</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the following will train 24 models, one for each horizon</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>individual_fcst <span class="op">=</span> fcst.fit(train, max_horizon<span class="op">=</span>max_horizon)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>individual_preds <span class="op">=</span> individual_fcst.predict(max_horizon)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>avg_mape_individual <span class="op">=</span> avg_mape(individual_preds).rename(<span class="st">'individual'</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the following will train a single model and use the recursive strategy</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>recursive_fcst <span class="op">=</span> fcst.fit(train)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>recursive_preds <span class="op">=</span> recursive_fcst.predict(max_horizon)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>avg_mape_recursive <span class="op">=</span> avg_mape(recursive_preds).rename(<span class="st">'recursive'</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># results</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Average MAPE per method and serie'</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>avg_mape_individual.to_frame().join(avg_mape_recursive).applymap(<span class="st">'</span><span class="sc">{:.1%}</span><span class="st">'</span>.<span class="bu">format</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average MAPE per method and serie</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">individual</th>
<th data-quarto-table-cell-role="th">recursive</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">H196</td>
<td>0.5%</td>
<td>0.6%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">H256</td>
<td>0.7%</td>
<td>0.6%</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">H381</td>
<td>48.9%</td>
<td>20.3%</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">H413</td>
<td>26.9%</td>
<td>35.1%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="cross-validation" class="level3">
<h3 class="anchored" data-anchor-id="cross-validation">Cross validation</h3>
<p>If we would like to know how good our forecast will be for a specific model and set of features then we can perform cross validation. What cross validation does is take our data and split it in two parts, where the first part is used for training and the second one for validation. Since the data is time dependant we usually take the last <em>x</em> observations from our data as the validation set.</p>
<p>This process is implemented in <code>MLForecast.cross_validation</code>, which takes our data and performs the process described above for <code>n_windows</code> times where each window has <code>h</code> validation samples in it. For example, if we have 100 samples and we want to perform 2 backtests each of size 14, the splits will be as follows:</p>
<ol type="1">
<li>Train: 1 to 72. Validation: 73 to 86.</li>
<li>Train: 1 to 86. Validation: 87 to 100.</li>
</ol>
<p>You can control the size between each cross validation window using the <code>step_size</code> argument. For example, if we have 100 samples and we want to perform 2 backtests each of size 14 and move one step ahead in each fold (<code>step_size=1</code>), the splits will be as follows:</p>
<ol type="1">
<li>Train: 1 to 85. Validation: 86 to 99.</li>
<li>Train: 1 to 86. Validation: 87 to 100.</li>
</ol>
<p>You can also perform cross validation without refitting your models for each window by setting <code>refit=False</code>. This allows you to evaluate the performance of your models using multiple window sizes without having to retrain them each time.</p>
<hr>
</section>
<section id="mlforecast.cross_validation" class="level3">
<h3 class="anchored" data-anchor-id="mlforecast.cross_validation">MLForecast.cross_validation</h3>
<blockquote class="blockquote">
<pre><code> MLForecast.cross_validation (df:pandas.core.frame.DataFrame,
                              n_windows:int, h:int,
                              id_col:str='unique_id', time_col:str='ds',
                              target_col:str='y',
                              step_size:Optional[int]=None,
                              static_features:Optional[List[str]]=None,
                              dropna:bool=True,
                              keep_last_n:Optional[int]=None,
                              refit:bool=True,
                              max_horizon:Optional[int]=None, before_predi
                              ct_callback:Optional[Callable]=None, after_p
                              redict_callback:Optional[Callable]=None, pre
                              diction_intervals:Optional[mlforecast.utils.
                              PredictionIntervals]=None,
                              level:Optional[List[Union[int,float]]]=None,
                              input_size:Optional[int]=None,
                              fitted:bool=False, data:Optional[pandas.core
                              .frame.DataFrame]=None,
                              window_size:Optional[int]=None)</code></pre>
</blockquote>
<p>Perform time series cross validation. Creates <code>n_windows</code> splits where each window has <code>h</code> test periods, trains the models, computes the predictions and merges the actuals.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>df</td>
<td>DataFrame</td>
<td></td>
<td>Series data in long format.</td>
</tr>
<tr class="even">
<td>n_windows</td>
<td>int</td>
<td></td>
<td>Number of windows to evaluate.</td>
</tr>
<tr class="odd">
<td>h</td>
<td>int</td>
<td></td>
<td>Forecast horizon.</td>
</tr>
<tr class="even">
<td>id_col</td>
<td>str</td>
<td>unique_id</td>
<td>Column that identifies each serie.</td>
</tr>
<tr class="odd">
<td>time_col</td>
<td>str</td>
<td>ds</td>
<td>Column that identifies each timestep, its values can be timestamps or integers.</td>
</tr>
<tr class="even">
<td>target_col</td>
<td>str</td>
<td>y</td>
<td>Column that contains the target.</td>
</tr>
<tr class="odd">
<td>step_size</td>
<td>typing.Optional[int]</td>
<td>None</td>
<td>Step size between each cross validation window. If None it will be equal to <code>h</code>.</td>
</tr>
<tr class="even">
<td>static_features</td>
<td>typing.Optional[typing.List[str]]</td>
<td>None</td>
<td>Names of the features that are static and will be repeated when forecasting.</td>
</tr>
<tr class="odd">
<td>dropna</td>
<td>bool</td>
<td>True</td>
<td>Drop rows with missing values produced by the transformations.</td>
</tr>
<tr class="even">
<td>keep_last_n</td>
<td>typing.Optional[int]</td>
<td>None</td>
<td>Keep only these many records from each serie for the forecasting step. Can save time and memory if your features allow it.</td>
</tr>
<tr class="odd">
<td>refit</td>
<td>bool</td>
<td>True</td>
<td>Retrain model for each cross validation window.<br>If False, the models are trained at the beginning and then used to predict each window.</td>
</tr>
<tr class="even">
<td>max_horizon</td>
<td>typing.Optional[int]</td>
<td>None</td>
<td></td>
</tr>
<tr class="odd">
<td>before_predict_callback</td>
<td>typing.Optional[typing.Callable]</td>
<td>None</td>
<td>Function to call on the features before computing the predictions.<br> This function will take the input dataframe that will be passed to the model for predicting and should return a dataframe with the same structure.<br> The series identifier is on the index.</td>
</tr>
<tr class="even">
<td>after_predict_callback</td>
<td>typing.Optional[typing.Callable]</td>
<td>None</td>
<td>Function to call on the predictions before updating the targets.<br> This function will take a pandas Series with the predictions and should return another one with the same structure.<br> The series identifier is on the index.</td>
</tr>
<tr class="odd">
<td>prediction_intervals</td>
<td>typing.Optional[mlforecast.utils.PredictionIntervals]</td>
<td>None</td>
<td>Configuration to calibrate prediction intervals (Conformal Prediction).</td>
</tr>
<tr class="even">
<td>level</td>
<td>typing.Optional[typing.List[typing.Union[int, float]]]</td>
<td>None</td>
<td>Confidence levels between 0 and 100 for prediction intervals.</td>
</tr>
<tr class="odd">
<td>input_size</td>
<td>typing.Optional[int]</td>
<td>None</td>
<td>Maximum training samples per serie in each window. If None, will use an expanding window.</td>
</tr>
<tr class="even">
<td>fitted</td>
<td>bool</td>
<td>False</td>
<td>Store the in-sample predictions.</td>
</tr>
<tr class="odd">
<td>data</td>
<td>typing.Optional[pandas.core.frame.DataFrame]</td>
<td>None</td>
<td>Series data in long format. This argument has been replaced by df and will be removed in a later release.</td>
</tr>
<tr class="even">
<td>window_size</td>
<td>typing.Optional[int]</td>
<td>None</td>
<td>Forecast horizon. This argument has been replaced by h and will be removed in a later release.</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>pandas DataFrame</strong></td>
<td></td>
<td><strong>Predictions for each window with the series id, timestamp, last train date, target value and predictions from each model.</strong></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fcst <span class="op">=</span> MLForecast(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    models<span class="op">=</span>lgb.LGBMRegressor(random_state<span class="op">=</span><span class="dv">0</span>),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    lags<span class="op">=</span>[<span class="dv">24</span> <span class="op">*</span> (i<span class="op">+</span><span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)],</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    lag_transforms<span class="op">=</span>{</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>: [(rolling_mean, <span class="dv">24</span>)],</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">24</span>: [(rolling_mean, <span class="dv">24</span>)],</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>        <span class="dv">48</span>: [(ewm_mean, <span class="fl">0.3</span>)],</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    num_threads<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    target_transforms<span class="op">=</span>[Differences([<span class="dv">24</span>])],</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>cv_results <span class="op">=</span> fcst.cross_validation(</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    train,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    n_windows<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    h<span class="op">=</span>horizon,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    step_size<span class="op">=</span>horizon,</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    fitted<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>cv_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">cutoff</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">LGBMRegressor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>H196</td>
<td>769</td>
<td>768</td>
<td>15.2</td>
<td>15.167163</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>H196</td>
<td>770</td>
<td>768</td>
<td>14.8</td>
<td>14.767163</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>H196</td>
<td>771</td>
<td>768</td>
<td>14.4</td>
<td>14.467163</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>H196</td>
<td>772</td>
<td>768</td>
<td>14.1</td>
<td>14.167163</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>H196</td>
<td>773</td>
<td>768</td>
<td>13.8</td>
<td>13.867163</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">187</td>
<td>H413</td>
<td>956</td>
<td>912</td>
<td>59.0</td>
<td>64.284167</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188</td>
<td>H413</td>
<td>957</td>
<td>912</td>
<td>58.0</td>
<td>64.830429</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">189</td>
<td>H413</td>
<td>958</td>
<td>912</td>
<td>53.0</td>
<td>40.726851</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">190</td>
<td>H413</td>
<td>959</td>
<td>912</td>
<td>38.0</td>
<td>42.739657</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">191</td>
<td>H413</td>
<td>960</td>
<td>912</td>
<td>46.0</td>
<td>52.802769</td>
</tr>
</tbody>
</table>

<p>768 rows √ó 5 columns</p>
</div>
</div>
</div>
<p>Since we set <code>fitted=True</code> we can access the predictions for the training sets as well with the <code>cross_validation_fitted_values</code> method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fcst.cross_validation_fitted_values()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">fold</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">LGBMRegressor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>H196</td>
<td>1</td>
<td>0</td>
<td>11.8</td>
<td>15.167163</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>H196</td>
<td>2</td>
<td>0</td>
<td>11.4</td>
<td>14.767163</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>H196</td>
<td>3</td>
<td>0</td>
<td>11.1</td>
<td>14.467163</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>H196</td>
<td>4</td>
<td>0</td>
<td>10.8</td>
<td>14.167163</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>H196</td>
<td>5</td>
<td>0</td>
<td>10.6</td>
<td>13.867163</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13435</td>
<td>H413</td>
<td>908</td>
<td>3</td>
<td>49.0</td>
<td>40.262691</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13436</td>
<td>H413</td>
<td>909</td>
<td>3</td>
<td>39.0</td>
<td>26.603123</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13437</td>
<td>H413</td>
<td>910</td>
<td>3</td>
<td>29.0</td>
<td>42.545732</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13438</td>
<td>H413</td>
<td>911</td>
<td>3</td>
<td>24.0</td>
<td>30.053714</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13439</td>
<td>H413</td>
<td>912</td>
<td>3</td>
<td>20.0</td>
<td>-13.589900</td>
</tr>
</tbody>
</table>

<p>13440 rows √ó 5 columns</p>
</div>
</div>
</div>
<p>We can also compute prediction intervals by passing a configuration to <code>prediction_intervals</code> as well as values for the width through <code>levels</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>cv_results_intervals <span class="op">=</span> fcst.cross_validation(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    train,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    n_windows<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    h<span class="op">=</span>horizon,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    step_size<span class="op">=</span>horizon,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    prediction_intervals<span class="op">=</span>PredictionIntervals(h<span class="op">=</span>horizon),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>]</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>cv_results_intervals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">cutoff</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">LGBMRegressor</th>
<th data-quarto-table-cell-role="th">LGBMRegressor-lo-90</th>
<th data-quarto-table-cell-role="th">LGBMRegressor-lo-80</th>
<th data-quarto-table-cell-role="th">LGBMRegressor-hi-80</th>
<th data-quarto-table-cell-role="th">LGBMRegressor-hi-90</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>H196</td>
<td>769</td>
<td>768</td>
<td>15.2</td>
<td>15.167163</td>
<td>15.141751</td>
<td>15.141751</td>
<td>15.192575</td>
<td>15.192575</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>H196</td>
<td>770</td>
<td>768</td>
<td>14.8</td>
<td>14.767163</td>
<td>14.741751</td>
<td>14.741751</td>
<td>14.792575</td>
<td>14.792575</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>H196</td>
<td>771</td>
<td>768</td>
<td>14.4</td>
<td>14.467163</td>
<td>14.399951</td>
<td>14.407328</td>
<td>14.526998</td>
<td>14.534374</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>H196</td>
<td>772</td>
<td>768</td>
<td>14.1</td>
<td>14.167163</td>
<td>14.092575</td>
<td>14.092575</td>
<td>14.241751</td>
<td>14.241751</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>H196</td>
<td>773</td>
<td>768</td>
<td>13.8</td>
<td>13.867163</td>
<td>13.792575</td>
<td>13.792575</td>
<td>13.941751</td>
<td>13.941751</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">187</td>
<td>H413</td>
<td>956</td>
<td>912</td>
<td>59.0</td>
<td>64.284167</td>
<td>29.890099</td>
<td>34.371545</td>
<td>94.196788</td>
<td>98.678234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188</td>
<td>H413</td>
<td>957</td>
<td>912</td>
<td>58.0</td>
<td>64.830429</td>
<td>56.874572</td>
<td>57.827689</td>
<td>71.833169</td>
<td>72.786285</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">189</td>
<td>H413</td>
<td>958</td>
<td>912</td>
<td>53.0</td>
<td>40.726851</td>
<td>35.296195</td>
<td>35.846206</td>
<td>45.607495</td>
<td>46.157506</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">190</td>
<td>H413</td>
<td>959</td>
<td>912</td>
<td>38.0</td>
<td>42.739657</td>
<td>35.292153</td>
<td>35.807640</td>
<td>49.671674</td>
<td>50.187161</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">191</td>
<td>H413</td>
<td>960</td>
<td>912</td>
<td>46.0</td>
<td>52.802769</td>
<td>42.465597</td>
<td>43.895670</td>
<td>61.709869</td>
<td>63.139941</td>
</tr>
</tbody>
</table>

<p>768 rows √ó 9 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">10</span>))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> uid, axi <span class="kw">in</span> <span class="bu">zip</span>(sample_ids, ax.flat):</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> cv_results[cv_results[<span class="st">'unique_id'</span>].eq(uid)].drop(columns<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'cutoff'</span>])</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    subset.set_index(<span class="st">'ds'</span>).plot(ax<span class="op">=</span>axi, title<span class="op">=</span>uid)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">'figs/forecast__cross_validation.png'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="figs/forecast__cross_validation.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">10</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> uid, axi <span class="kw">in</span> <span class="bu">zip</span>(sample_ids, ax.flat):</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> cv_results_intervals[cv_results_intervals[<span class="st">'unique_id'</span>].eq(uid)].drop(columns<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'cutoff'</span>]).set_index(<span class="st">'ds'</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    subset[[<span class="st">'y'</span>, <span class="st">'LGBMRegressor'</span>]].plot(ax<span class="op">=</span>axi, title<span class="op">=</span>uid)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    axi.fill_between(</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        subset.index, </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        subset[<span class="st">'LGBMRegressor-lo-90'</span>].values, </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>        subset[<span class="st">'LGBMRegressor-hi-90'</span>].values,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">'LGBMRegressor-level-90'</span>,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'orange'</span>,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.2</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    axi.legend()</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">'figs/forecast__cross_validation_intervals.png'</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>plt.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="figs/forecast__cross_validation_intervals.png" class="img-fluid"></p>
</section>
<section id="create-mlforecast-from-lightgbmcv" class="level3">
<h3 class="anchored" data-anchor-id="create-mlforecast-from-lightgbmcv">Create MLForecast from LightGBMCV</h3>
<p>Once you‚Äôve found a set of features and parameters that work for your problem you can build a forecast object from it using <code>MLForecast.from_cv</code>, which takes the trained <code>LightGBMCV</code> object and builds an <code>MLForecast</code> object that will use the same features and parameters. Then you can call fit and predict as you normally would.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>cv <span class="op">=</span> LightGBMCV(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    freq<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    lags<span class="op">=</span>[<span class="dv">24</span> <span class="op">*</span> (i<span class="op">+</span><span class="dv">1</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>)],</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    lag_transforms<span class="op">=</span>{</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">48</span>: [(ewm_mean, <span class="fl">0.3</span>)],</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    num_threads<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    target_transforms<span class="op">=</span>[Differences([<span class="dv">24</span>])]</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>hist <span class="op">=</span> cv.fit(</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    train,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    n_windows<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    h<span class="op">=</span>horizon,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    params<span class="op">=</span>{<span class="st">'verbosity'</span>: <span class="op">-</span><span class="dv">1</span>},</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[LightGBM] [Info] Start training from score 0.084340
[10] mape: 0.118569
[20] mape: 0.111506
[30] mape: 0.107314
[40] mape: 0.106089
[50] mape: 0.106630
Early stopping at round 50
Using best iteration: 40</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fcst <span class="op">=</span> MLForecast.from_cv(cv)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> cv.best_iteration_ <span class="op">==</span> fcst.models[<span class="st">'LGBMRegressor'</span>].n_estimators</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>fcst.fit(train)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fcst.predict(horizon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">LGBMRegressor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>H196</td>
<td>961</td>
<td>16.111079</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>H196</td>
<td>962</td>
<td>15.711079</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>H196</td>
<td>963</td>
<td>15.311079</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>H196</td>
<td>964</td>
<td>15.011079</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>H196</td>
<td>965</td>
<td>14.711079</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">187</td>
<td>H413</td>
<td>1004</td>
<td>92.722032</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">188</td>
<td>H413</td>
<td>1005</td>
<td>69.153603</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">189</td>
<td>H413</td>
<td>1006</td>
<td>68.811675</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">190</td>
<td>H413</td>
<td>1007</td>
<td>53.693346</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">191</td>
<td>H413</td>
<td>1008</td>
<td>46.055481</td>
</tr>
</tbody>
</table>

<p>192 rows √ó 3 columns</p>
</div>
</div>
</div>
</section>
<section id="dynamic-features" class="level3">
<h3 class="anchored" data-anchor-id="dynamic-features">Dynamic features</h3>
<p>We‚Äôre going to use a synthetic dataset from this point onwards to demonstrate some other functionalities regarding external regressors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>series <span class="op">=</span> generate_daily_series(<span class="dv">100</span>, equal_ends<span class="op">=</span><span class="va">True</span>, n_static_features<span class="op">=</span><span class="dv">2</span>, static_as_categorical<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>series</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">static_0</th>
<th data-quarto-table-cell-role="th">static_1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>id_00</td>
<td>2000-10-05</td>
<td>3.981198</td>
<td>79</td>
<td>45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>id_00</td>
<td>2000-10-06</td>
<td>10.327401</td>
<td>79</td>
<td>45</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>id_00</td>
<td>2000-10-07</td>
<td>17.657474</td>
<td>79</td>
<td>45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>id_00</td>
<td>2000-10-08</td>
<td>25.898790</td>
<td>79</td>
<td>45</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>id_00</td>
<td>2000-10-09</td>
<td>34.494040</td>
<td>79</td>
<td>45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26998</td>
<td>id_99</td>
<td>2001-05-10</td>
<td>45.340051</td>
<td>69</td>
<td>35</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26999</td>
<td>id_99</td>
<td>2001-05-11</td>
<td>3.022948</td>
<td>69</td>
<td>35</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27000</td>
<td>id_99</td>
<td>2001-05-12</td>
<td>10.131371</td>
<td>69</td>
<td>35</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27001</td>
<td>id_99</td>
<td>2001-05-13</td>
<td>14.572434</td>
<td>69</td>
<td>35</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27002</td>
<td>id_99</td>
<td>2001-05-14</td>
<td>22.816357</td>
<td>69</td>
<td>35</td>
</tr>
</tbody>
</table>

<p>27003 rows √ó 5 columns</p>
</div>
</div>
</div>
<p>As we saw in the previous example, the required columns are the series identifier, time and target. Whatever extra columns you have, like <code>static_0</code> and <code>static_1</code> here are considered to be static and are replicated when constructing the features for the next timestamp. You can disable this by passing <code>static_features</code> to <code>MLForecast.preprocess</code> or <code>MLForecast.fit</code> , which will only keep the columns you define there as static. Keep in mind that they will still be used for training, so you‚Äôll have to provide them to <code>MLForecast.predict</code> through the <code>dynamic_dfs</code> argument.</p>
<p>By default the predict method repeats the static features and updates the transformations and the date features. If you have dynamic features like prices or a calendar with holidays you can pass them as a list to the <code>dynamic_dfs</code> argument of <code>MLForecast.predict</code>, which will call <code>pd.DataFrame.merge</code> on each of them in order.</p>
<p>Here‚Äôs an example:</p>
<p>Suppose that we have a <code>product_id</code> column and we have a catalog for prices based on that <code>product_id</code> and the date.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>dynamic_series <span class="op">=</span> series.rename(columns<span class="op">=</span>{<span class="st">'static_1'</span>: <span class="st">'product_id'</span>})</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>prices_catalog <span class="op">=</span> generate_prices_for_series(dynamic_series)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>prices_catalog</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2000-06-09</td>
<td>1</td>
<td>0.548814</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2000-06-10</td>
<td>1</td>
<td>0.715189</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2000-06-11</td>
<td>1</td>
<td>0.602763</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2000-06-12</td>
<td>1</td>
<td>0.544883</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2000-06-13</td>
<td>1</td>
<td>0.423655</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20180</td>
<td>2001-05-17</td>
<td>99</td>
<td>0.223520</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20181</td>
<td>2001-05-18</td>
<td>99</td>
<td>0.446104</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20182</td>
<td>2001-05-19</td>
<td>99</td>
<td>0.044783</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20183</td>
<td>2001-05-20</td>
<td>99</td>
<td>0.483216</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20184</td>
<td>2001-05-21</td>
<td>99</td>
<td>0.799660</td>
</tr>
</tbody>
</table>

<p>20185 rows √ó 3 columns</p>
</div>
</div>
</div>
<p>And you have already merged these prices into your series dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>series_with_prices <span class="op">=</span> dynamic_series.merge(prices_catalog, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>series_with_prices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">static_0</th>
<th data-quarto-table-cell-role="th">product_id</th>
<th data-quarto-table-cell-role="th">price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>id_00</td>
<td>2000-10-05</td>
<td>3.981198</td>
<td>79</td>
<td>45</td>
<td>0.570826</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>id_00</td>
<td>2000-10-06</td>
<td>10.327401</td>
<td>79</td>
<td>45</td>
<td>0.260562</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>id_00</td>
<td>2000-10-07</td>
<td>17.657474</td>
<td>79</td>
<td>45</td>
<td>0.274048</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>id_00</td>
<td>2000-10-08</td>
<td>25.898790</td>
<td>79</td>
<td>45</td>
<td>0.433878</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>id_00</td>
<td>2000-10-09</td>
<td>34.494040</td>
<td>79</td>
<td>45</td>
<td>0.653738</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26998</td>
<td>id_99</td>
<td>2001-05-10</td>
<td>45.340051</td>
<td>69</td>
<td>35</td>
<td>0.792152</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26999</td>
<td>id_99</td>
<td>2001-05-11</td>
<td>3.022948</td>
<td>69</td>
<td>35</td>
<td>0.782687</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27000</td>
<td>id_99</td>
<td>2001-05-12</td>
<td>10.131371</td>
<td>69</td>
<td>35</td>
<td>0.019463</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27001</td>
<td>id_99</td>
<td>2001-05-13</td>
<td>14.572434</td>
<td>69</td>
<td>35</td>
<td>0.190413</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27002</td>
<td>id_99</td>
<td>2001-05-14</td>
<td>22.816357</td>
<td>69</td>
<td>35</td>
<td>0.653394</td>
</tr>
</tbody>
</table>

<p>27003 rows √ó 6 columns</p>
</div>
</div>
</div>
<p>This dataframe will be passed to <code>MLForecast.fit</code> (or <code>MLForecast.preprocess</code>), however since the price is dynamic we have to tell that method that only <code>static_0</code> and <code>product_id</code> are static and we‚Äôll have to update <code>price</code> in every timestep, which basically involves merging the updated features with the prices catalog.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> even_day(dates):</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dates.day <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>fcst <span class="op">=</span> MLForecast(</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    models<span class="op">=</span>lgb.LGBMRegressor(n_jobs<span class="op">=</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">0</span>),</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    freq<span class="op">=</span><span class="st">'D'</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    lags<span class="op">=</span>[<span class="dv">7</span>],</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    lag_transforms<span class="op">=</span>{</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>: [expanding_mean],</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>        <span class="dv">7</span>: [(rolling_mean, <span class="dv">14</span>)]</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    date_features<span class="op">=</span>[<span class="st">'dayofweek'</span>, <span class="st">'month'</span>, even_day],</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    num_threads<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>fcst.fit(series_with_prices, static_features<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'static_0'</span>, <span class="st">'product_id'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>MLForecast(models=[LGBMRegressor], freq=&lt;Day&gt;, lag_features=['lag7', 'expanding_mean_lag1', 'rolling_mean_lag7_window_size14'], date_features=['dayofweek', 'month', &lt;function even_day&gt;], num_threads=2)</code></pre>
</div>
</div>
<p>The features used for training are stored in <code>MLForecast.ts.features_order_</code>, as you can see <code>price</code> was used for training.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fcst.ts.features_order_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['unique_id',
 'static_0',
 'product_id',
 'price',
 'lag7',
 'expanding_mean_lag1',
 'rolling_mean_lag7_window_size14',
 'dayofweek',
 'month',
 'even_day']</code></pre>
</div>
</div>
<p>So in order to update the price in each timestep we just call <code>MLForecast.predict</code> with our forecast horizon and pass the prices catalog as a dynamic dataframe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> fcst.predict(<span class="dv">7</span>, dynamic_dfs<span class="op">=</span>[prices_catalog])</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>preds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">LGBMRegressor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>id_00</td>
<td>2001-05-15</td>
<td>42.406978</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>id_00</td>
<td>2001-05-16</td>
<td>50.076236</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>id_00</td>
<td>2001-05-17</td>
<td>1.904567</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>id_00</td>
<td>2001-05-18</td>
<td>10.259930</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>id_00</td>
<td>2001-05-19</td>
<td>18.727878</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">695</td>
<td>id_99</td>
<td>2001-05-17</td>
<td>44.266018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">696</td>
<td>id_99</td>
<td>2001-05-18</td>
<td>1.936728</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">697</td>
<td>id_99</td>
<td>2001-05-19</td>
<td>9.091219</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">698</td>
<td>id_99</td>
<td>2001-05-20</td>
<td>15.262409</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">699</td>
<td>id_99</td>
<td>2001-05-21</td>
<td>22.840666</td>
</tr>
</tbody>
</table>

<p>700 rows √ó 3 columns</p>
</div>
</div>
</div>
</section>
<section id="custom-predictions" class="level3">
<h3 class="anchored" data-anchor-id="custom-predictions">Custom predictions</h3>
<p>As you may have noticed <code>MLForecast.predict</code> can take a <code>before_predict_callback</code> and <code>after_predict_callback</code>. By default the predict method repeats the static features and updates the transformations and the date features. If you have dynamic features you can pass them as a list to <code>MLForecast.predict</code> in the <code>dynamic_dfs</code> argument. However, if you want to do something to the input before predicting or do something to the output before it gets used to update the target (and thus the next features that rely on lags), you can pass a function to run at any of these times.</p>
<p>Suppose that we want to look at our inputs and scale our predictions so that our series are updated with these scaled values. We can achieve that with the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> inspect_input(new_x):</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Displays the first row of our input to inspect it"""</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">'Inputs:'</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    display(new_x.head(<span class="dv">1</span>))</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_x</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> increase_predictions(predictions):</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Prints the last prediction and increases all of them by 10%."""</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Prediction:</span><span class="ch">\n</span><span class="sc">{</span>predictions<span class="sc">.</span>tail(<span class="dv">1</span>)<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">1.1</span> <span class="op">*</span> predictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now we just pass these functions to <code>MLForecast.predict</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>fcst <span class="op">=</span> MLForecast(lgb.LGBMRegressor(), freq<span class="op">=</span><span class="st">'D'</span>, lags<span class="op">=</span>[<span class="dv">1</span>])</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>fcst.fit(series)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>preds <span class="op">=</span> fcst.predict(<span class="dv">2</span>, before_predict_callback<span class="op">=</span>inspect_input, after_predict_callback<span class="op">=</span>increase_predictions)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>preds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Inputs:
Prediction:
unique_id
id_99    30.643253
dtype: float64

Inputs:
Prediction:
unique_id
id_99    41.024064
dtype: float64
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">static_0</th>
<th data-quarto-table-cell-role="th">static_1</th>
<th data-quarto-table-cell-role="th">lag1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>79</td>
<td>45</td>
<td>34.862245</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">static_0</th>
<th data-quarto-table-cell-role="th">static_1</th>
<th data-quarto-table-cell-role="th">lag1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>79</td>
<td>45</td>
<td>46.396346</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">LGBMRegressor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>id_00</td>
<td>2001-05-15</td>
<td>46.396346</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>id_00</td>
<td>2001-05-16</td>
<td>23.651944</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>id_01</td>
<td>2001-05-15</td>
<td>14.388954</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>id_01</td>
<td>2001-05-16</td>
<td>17.796990</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>id_02</td>
<td>2001-05-15</td>
<td>15.640528</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">195</td>
<td>id_97</td>
<td>2001-05-16</td>
<td>39.849693</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">196</td>
<td>id_98</td>
<td>2001-05-15</td>
<td>8.408627</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">197</td>
<td>id_98</td>
<td>2001-05-16</td>
<td>4.290933</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">198</td>
<td>id_99</td>
<td>2001-05-15</td>
<td>33.707579</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">199</td>
<td>id_99</td>
<td>2001-05-16</td>
<td>45.126470</td>
</tr>
</tbody>
</table>

<p>200 rows √ó 3 columns</p>
</div>
</div>
</div>


</section>
</section>

<p>Give us a ‚≠ê on <a href="https://github.com/nixtla/mlforecast">Github</a></p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>